# 1. Create Dataform Repository in GCP UI
Name: gmp-clearview-cosmoprof-ca-web
Region: us-central
ActAs: uncheck Enforce policy
Click Grant All permissions to dataform service acount


#Save project info into a shell variable:

gcloud config set project cosmoprof-ca-ga4-web
PROJECT_ID=cosmoprof-ca-ga4-web
PROJECT_NUMBER=$(gcloud projects describe $PROJECT_ID --format="value(projectNumber)")

#Identify the default Dataform service account : service-PROJECT_NUMBER@gcp-sa-dataform.iam.gserviceaccount.com
DATAFORM_SA="service-${PROJECT_NUMBER}@gcp-sa-dataform.iam.gserviceaccount.com"

# Enable rquired APIs: 

# Dataform API
gcloud services enable dataform.googleapis.com #project=$PROJECT_ID
# Secret Manager API
gcloud services enable secretmanager.googleapis.com #project=$PROJECT_ID


#Grant roles to the Dataform service account
#BigQuery Metadata Viewer
gcloud projects add-iam-policy-binding $PROJECT_ID \
  --member="serviceAccount:$DATAFORM_SA" \
  --role="roles/bigquery.metadataViewer"

# Secret Manager Secret Accessor
gcloud projects add-iam-policy-binding $PROJECT_ID \
  --member="serviceAccount:$DATAFORM_SA" \
  --role="roles/secretmanager.secretAccessor"

# BigQuey Daa Editor
gcloud projects add-iam-policy-binding $PROJECT_ID \
  --member="serviceAccount:$DATAFORM_SA" \
  --role="roles/bigquery.dataEditor"


#Create a secret
echo -n "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" | gcloud secrets create gmp-clearview-token \#
  --replication-policy="automatic" \
  --data-file=-
  --project=$PROJECT_ID




# 2. Create development workspace
Name: name it after the bracnch name (lowercase): cosmo-web-ca

# 3. Connect to Github 
Protocol: HTTPS
Git repo URL: https://github.com/Infotrust-llc/gmp-clearview-sallybeauty.git
Default branch name: Cosmo-Web-US

# 4. Create Development workspace
name: [brand]-[stream type]-[country]           # cosmo-app-us, sallybeauty-web-ca

